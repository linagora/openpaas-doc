<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="generator" content="Jekyll v3.6.2">

		<link href="https://fonts.googleapis.com/css?family=Roboto|Inconsolata:400,700" rel="stylesheet">
		<link rel="stylesheet" href="/css/modules/bootstrap.css">
		<link rel="stylesheet" href="/css/modules/font-awesome-4.7.0/css/font-awesome.min.css">
		<link rel="stylesheet" href="/css/main.css">
		<link rel="stylesheet" href="/css/modules/swagger-ui.min.css">
		<link rel="stylesheet" href="/css/modules/viewer.min.css">
		<link rel="stylesheet" href="/css/overrides.css">
		<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
		<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
		<link rel="manifest" href="/images/manifest.json">
		<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">
		<link rel="shortcut icon" href="/images/favicon.ico">
		<meta name="msapplication-config" content="/images/browserconfig.xml">
		<meta name="theme-color" content="#ffffff">

		<script src="/js/modules/jquery-2.2.0.min.js"></script>
		<script src="/js/modules/bootstrap.min.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular-resource.min.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular-route.min.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular-animate.min.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular-sanitize.min.js"></script>
		<script src="/js/modules/viewer.min.js"></script>
		<script src="/js/modules/swagger-ui/angular-swagger-ui.min.js"></script>
		<script src="/js/modules/swagger-ui/swagger-external-references.min.js"></script>
		<script src="/js/modules/swagger-ui/swagger1-to-swagger2-converter.min.js"></script>
		<script src="/js/swagger-authentication.js"></script>
		<script src="/js/app.js"></script>

		<title> Configuration |  OpenPaaS documentation</title>
		<link type="application/atom+xml" rel="alternate" href="https://openpaas.github.io/openpaas-doc/feed.xml" title="OpenPaaS Documentation" />

		
	</head>

	<body>
		<header>
			<h1>
				<a href="/"><img src="/images/white-logo.png" width="40" height="40" alt="OpenPaaS Documentation logo"></a>
				OpenPaaS Documentation
				<button type="button" class="open-nav" id="open-nav"></button>
			</h1>

			<form action="/search/" method="get">
				<input type="text" name="q" id="search-input" placeholder="Search" autofocus>
				<input type="submit" value="Search" style="display: none;">
			</form>

			<nav class="full-navigation">
				<ul>
					<li class="nav-item top-level ">
						
						<a href="/">Welcome</a>
					</li>
				</ul>

				<ul>
					
					
						<li class="nav-item top-level ">
							
							<a href="/getting-started/docker/">Getting started</a>
							<ul>
								
									<li class="nav-item "><a href="/getting-started/docker/">Get started with Docker</a></li>
								
									<li class="nav-item "><a href="/getting-started/linux/">Get started with Linux</a></li>
								
									<li class="nav-item "><a href="/getting-started/supported-platforms/">Supported platforms</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/apis/web/">APIs</a>
							<ul>
								
									<li class="nav-item "><a href="/apis/web/">Web API</a></li>
								
									<li class="nav-item "><a href="/apis/swagger/">Swagger</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/apis/auth/index/">APIs - Auth</a>
							<ul>
								
									<li class="nav-item "><a href="/apis/auth/index/">Overview</a></li>
								
									<li class="nav-item "><a href="/apis/auth/basic/">Basic Access</a></li>
								
									<li class="nav-item "><a href="/apis/auth/cookies/">Cookies</a></li>
								
									<li class="nav-item "><a href="/apis/auth/lemonldap/">SSO - LemonLDAP</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/dev/debug/">Dev</a>
							<ul>
								
									<li class="nav-item "><a href="/dev/debug/">Debug</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/devops/james/">Devops</a>
							<ul>
								
									<li class="nav-item "><a href="/devops/james/">James</a></li>
								
									<li class="nav-item "><a href="/devops/kibana/">Kibana</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/frontend/vue/">Frontend</a>
							<ul>
								
									<li class="nav-item "><a href="/frontend/vue/">Vue.js</a></li>
								
									<li class="nav-item "><a href="/frontend/vue-components/">Vue Components</a></li>
								
									<li class="nav-item "><a href="/frontend/i18n/">I18n</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level current">
							
							<a href="/core/configuration/">OpenPaaS Core</a>
							<ul>
								
									<li class="nav-item current"><a href="/core/configuration/">Configuration</a></li>
								
									<li class="nav-item "><a href="/core/pubsub/">Pubsub</a></li>
								
									<li class="nav-item "><a href="/core/eventsourcing/">EventSourcing</a></li>
								
									<li class="nav-item "><a href="/core/provisioning/">Provisioning</a></li>
								
									<li class="nav-item "><a href="/core/search/">Search</a></li>
								
									<li class="nav-item "><a href="/core/i18n/">I18n</a></li>
								
									<li class="nav-item "><a href="/core/people/">People API</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/modules/howto/index/">OpenPaaS Modules</a>
							<ul>
								
									<li class="nav-item "><a href="/modules/howto/index/">Overview</a></li>
								
									<li class="nav-item "><a href="/modules/howto/quickstart/">Quickstart</a></li>
								
									<li class="nav-item "><a href="/modules/howto/deep-dive/">Deep dive</a></li>
								
									<li class="nav-item "><a href="/modules/howto/install/">Install</a></li>
								
									<li class="nav-item "><a href="/modules/howto/electron-compatibility/">How to be Electron compatible</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/modules/admin/index/">OpenPaaS Modules - Admin</a>
							<ul>
								
									<li class="nav-item "><a href="/modules/admin/index/">Overview</a></li>
								
									<li class="nav-item "><a href="/modules/admin/domains/">Domains</a></li>
								
									<li class="nav-item "><a href="/modules/admin/configuration-page/">Add a configuration page</a></li>
								
									<li class="nav-item "><a href="/modules/admin/rest-api/">REST API</a></li>
								
									<li class="nav-item "><a href="/modules/admin/elasticsearch/">Elasticsearch</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/modules/calendar/index/">OpenPaaS Modules - Calendar</a>
							<ul>
								
									<li class="nav-item "><a href="/modules/calendar/index/">Overview</a></li>
								
									<li class="nav-item "><a href="/modules/calendar/shared/">Shared Calendars</a></li>
								
									<li class="nav-item "><a href="/modules/calendar/resource/">Calendar Resources</a></li>
								
									<li class="nav-item "><a href="/modules/calendar/api/">REST API</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/modules/community/index/">OpenPaaS Modules - Community</a>
							<ul>
								
									<li class="nav-item "><a href="/modules/community/index/">Overview</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/modules/contact/index/">OpenPaaS Modules - Contact</a>
							<ul>
								
									<li class="nav-item "><a href="/modules/contact/index/">Overview</a></li>
								
									<li class="nav-item "><a href="/modules/contact/collected/">Collected contacts</a></li>
								
									<li class="nav-item "><a href="/modules/contact/shared/">Shared Address Books</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/modules/group/index/">OpenPaaS Modules - Group</a>
							<ul>
								
									<li class="nav-item "><a href="/modules/group/index/">Overview</a></li>
								
									<li class="nav-item "><a href="/modules/group/rest-api/">REST API</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/modules/videoconference/index/">OpenPaaS Modules - VideoConference</a>
							<ul>
								
									<li class="nav-item "><a href="/modules/videoconference/index/">Overview</a></li>
								
									<li class="nav-item "><a href="/modules/videoconference/screensharing/">Screensharing</a></li>
								
							</ul>
						</li>
					
				</ul>

				<ul>
					<li class="nav-item top-level">
						<a href="javascript:;">Keep In Touch</a>
						<ul>
							<li class="nav-item">
								<a href="https://twitter.com/AwesomePaaS">@AwesomePaaS on Twitter</a>
							</li>
							<li class="nav-item">
								<a href="https://www.facebook.com/AwesomePaaS/">AwesomePaaS on Facebook</a>
							</li>
							<li class="nav-item">
								<a href="https://github.com/linagora/openpaas-esn/">Github</a>
							</li>
							<li class="nav-item">
								<a href="https://open-paas.org/">Web Site</a>
							</li>
							<li class="nav-item">
								<a href="https://linagora.com/">Linagora</a>
							</li>
						</ul>
					</li>
				</ul>


			</nav>
		</header>
		<section class="main">
			<div class="page-header">
				<h2>OpenPaaS Core</h2>
				<div class="page-title">
					<h3>Configuration</h3>
					<a href="https://github.com/linagora/openpaas-doc/edit/master/_docs/core/configuration.md" title="Edit this page on Github">
						<i class="fa fa-pencil-square-o" aria-hidden="true"></i>
					</a>
				</div>
			</div>
			<article class="content">
				<h2 class="no_toc" id="table-of-contents">Table of contents</h2>

<ul id="markdown-toc">
  <li><a href="#local-configuration" id="markdown-toc-local-configuration">Local configuration</a>    <ul>
      <li><a href="#overview" id="markdown-toc-overview">Overview</a></li>
      <li><a href="#usage" id="markdown-toc-usage">Usage</a></li>
    </ul>
  </li>
  <li><a href="#global-configuration" id="markdown-toc-global-configuration">Global configuration</a>    <ul>
      <li><a href="#overview-1" id="markdown-toc-overview-1">Overview</a>        <ul>
          <li><a href="#configuration-scope" id="markdown-toc-configuration-scope">Configuration scope</a></li>
          <li><a href="#configuration-inheritance" id="markdown-toc-configuration-inheritance">Configuration inheritance</a></li>
        </ul>
      </li>
      <li><a href="#usage-1" id="markdown-toc-usage-1">Usage</a></li>
    </ul>
  </li>
</ul>

<p>OpenPaaS has two types of configuration:</p>
<ul>
  <li>Local: Defines the local configurations of the current instance</li>
  <li>Global: Defines the configuration which is shared between on all the OpenPaaS instances</li>
</ul>

<h2 id="local-configuration">Local configuration</h2>

<h3 id="overview">Overview</h3>

<p>Local configuration of the application is stored in the <code class="highlighter-rouge">config/default.json</code> file.
You should not modify this file directly but instead define the <em>environment-based</em>
configuration file, e.g. <code class="highlighter-rouge">config/default.dev.json</code> for development and
<code class="highlighter-rouge">config/default.production.json</code> for production deployment.</p>

<p>The application relies on <code class="highlighter-rouge">NODE_ENV</code> environment variable to know which configuration
file to be loaded. For example, if <code class="highlighter-rouge">NODE_ENV=test</code>, it will load <code class="highlighter-rouge">config/default.test.json</code> file.</p>

<p>Note that the configuration defined in <code class="highlighter-rouge">./config/default.json</code> will not be overridden by the environment-based configuration file but instead inherited from it. The only exception is the array propertices, which will be overridden.</p>

<h3 id="usage">Usage</h3>

<p>The local configurations are stored in JSON structure so it is pretty easy to
read and write this type of configuration.</p>

<p>To read configurations, simply require the module in <code class="highlighter-rouge">backend/core/config</code>:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'...'</span><span class="p">)(</span><span class="s1">'default'</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">strategies</span><span class="p">);</span>
</code></pre></div></div>

<p>Since it is stored in file system, you simply modify the file to modify the configurations.</p>

<h2 id="global-configuration">Global configuration</h2>

<h3 id="overview-1">Overview</h3>

<p>The global configuration is stored in MongoDB under the <code class="highlighter-rouge">configurations</code> collection
in order to be shared over nodes.</p>

<p>A configurations document has the following structure:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "domain_id" : ObjectId("domain_id"),
  "user_id" : ObjectId("user_id"),
  "modules" : [
    {
      "name" : "module name",
      "configurations" : [
        {
          "name" : "config_name",
          "value" : Any
        }, {
          ...
        }
      ]
    }, {
      // other modules
    }
  ]
}
</code></pre></div></div>

<h4 id="configuration-scope">Configuration scope</h4>

<p>Each document has its scope, base on the values of <code class="highlighter-rouge">domain_id</code> and <code class="highlighter-rouge">user_id</code>:</p>
<ul>
  <li><strong>User-wide</strong>: configurations belong to a specific user in a specific domain, the document must contain both <code class="highlighter-rouge">domain_id</code> and <code class="highlighter-rouge">user_id</code></li>
  <li><strong>Domain-wide</strong>: configurations belong to a specific domain, the document must contain <code class="highlighter-rouge">domain_id</code> and no <code class="highlighter-rouge">user_id</code></li>
  <li><strong>System-wide</strong> (AKA platform-wide): configurations which will be applied to the whole system, the document must not contain neither <code class="highlighter-rouge">domain_id</code> or <code class="highlighter-rouge">user_id</code></li>
</ul>

<h4 id="configuration-inheritance">Configuration inheritance</h4>

<p>The global configuration has a concept of inheritance, which means if there is
no configuration in a scope, the configuration in wider scope will be used. For
example, if the user does not specify any configuration, the configuration of
his current domain will be used. And so on, if the configuration of a domain is
not specified, the system-wide configuration will be used.</p>

<h3 id="usage-1">Usage</h3>

<p>In both frontend and backend, the global configurations can be read by <code class="highlighter-rouge">esn-config</code>
module.</p>

<p>In backend, the code is placed in <code class="highlighter-rouge">backend/core/esn-config</code>:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">esnConfig</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'..'</span><span class="p">);</span>

<span class="c1">// get system-wide configuration</span>
<span class="nx">esnConfig</span><span class="p">(</span><span class="s1">'mail'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">inModule</span><span class="p">(</span><span class="s1">'core'</span><span class="p">)</span>
  <span class="p">.</span><span class="kd">get</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">config</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>
  <span class="p">});</span>

<span class="c1">// get domain-wide configuration</span>
<span class="nx">esnConfig</span><span class="p">(</span><span class="s1">'mail'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">inModule</span><span class="p">(</span><span class="s1">'core'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">forUser</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span>
  <span class="p">.</span><span class="kd">get</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">config</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>
  <span class="p">});</span>

<span class="c1">// get user-wide configuration</span>
<span class="kd">const</span> <span class="nx">userWide</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

<span class="nx">esnConfig</span><span class="p">(</span><span class="s1">'mail'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">inModule</span><span class="p">(</span><span class="s1">'core'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">forUser</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="nx">userWide</span><span class="p">)</span>
  <span class="p">.</span><span class="kd">get</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">config</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>
  <span class="p">});</span>
</code></pre></div></div>

<p>In frontend, you simply inject the <code class="highlighter-rouge">esnConfig</code> service to get the configuration,
the API is a bit different:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">esnConfig</span><span class="p">(</span><span class="s1">'core.datetime'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

			</article>
		</section>

		<script>
			var content = document.getElementsByClassName('content')[0];

			if (content) {
				var viewer = new Viewer(content, {
					movable: false,
					rotatable: false
				});

				var images = content.getElementsByTagName('img');
				for (var i = 0; i < images.length; i++) {
					images[i].style.cursor = 'pointer';
				}
			}

			document.getElementById("open-nav").addEventListener("click", function () {
				document.body.classList.toggle("nav-open");
			});
		</script>
	</body>
</html>
