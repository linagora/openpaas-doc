<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="generator" content="Jekyll v3.8.5">

		<link href="https://fonts.googleapis.com/css?family=Roboto|Inconsolata:400,700" rel="stylesheet">
		<link rel="stylesheet" href="/css/modules/bootstrap.css">
		<link rel="stylesheet" href="/css/modules/font-awesome-4.7.0/css/font-awesome.min.css">
		<link rel="stylesheet" href="/css/main.css">
		<link rel="stylesheet" href="/css/modules/swagger-ui.min.css">
		<link rel="stylesheet" href="/css/modules/viewer.min.css">
		<link rel="stylesheet" href="/css/overrides.css">
		<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
		<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
		<link rel="manifest" href="/images/manifest.json">
		<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">
		<link rel="shortcut icon" href="/images/favicon.ico">
		<meta name="msapplication-config" content="/images/browserconfig.xml">
		<meta name="theme-color" content="#ffffff">

		<script src="/js/modules/jquery-2.2.0.min.js"></script>
		<script src="/js/modules/bootstrap.min.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular-resource.min.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular-route.min.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular-animate.min.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular-sanitize.min.js"></script>
		<script src="/js/modules/viewer.min.js"></script>
		<script src="/js/modules/swagger-ui/angular-swagger-ui.min.js"></script>
		<script src="/js/modules/swagger-ui/swagger-external-references.min.js"></script>
		<script src="/js/modules/swagger-ui/swagger1-to-swagger2-converter.min.js"></script>
		<script src="/js/swagger-authentication.js"></script>
		<script src="/js/app.js"></script>

		<title> OpenID Connect |  OpenPaaS documentation</title>
		<link type="application/atom+xml" rel="alternate" href="https://openpaas.github.io/openpaas-doc/feed.xml" title="OpenPaaS Documentation" />

		
	</head>

	<body>
		<header>
			<h1>
				<a href="/"><img src="/images/white-logo.png" width="40" height="40" alt="OpenPaaS Documentation logo"></a>
				OpenPaaS Documentation
				<button type="button" class="open-nav" id="open-nav"></button>
			</h1>

			<form action="/search/" method="get">
				<input type="text" name="q" id="search-input" placeholder="Search" autofocus>
				<input type="submit" value="Search" style="display: none;">
			</form>

			<nav class="full-navigation">
				<ul>
					<li class="nav-item top-level ">
						
						<a href="/">Welcome</a>
					</li>
				</ul>

				<ul>
					
					
						<li class="nav-item top-level ">
							
							<a href="/getting-started/docker/">Getting started</a>
							<ul>
								
									<li class="nav-item "><a href="/getting-started/docker/">Get started with Docker</a></li>
								
									<li class="nav-item "><a href="/getting-started/linux/">Get started with Linux (deprecated)</a></li>
								
									<li class="nav-item "><a href="/getting-started/supported-platforms/">Supported platforms</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/apis/web/">APIs</a>
							<ul>
								
									<li class="nav-item "><a href="/apis/web/">Web API</a></li>
								
									<li class="nav-item "><a href="/apis/swagger/">Swagger</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level current">
							
							<a href="/apis/auth/index/">APIs - Auth</a>
							<ul>
								
									<li class="nav-item "><a href="/apis/auth/index/">Overview</a></li>
								
									<li class="nav-item "><a href="/apis/auth/basic/">Basic Access</a></li>
								
									<li class="nav-item "><a href="/apis/auth/cookies/">Cookies</a></li>
								
									<li class="nav-item "><a href="/apis/auth/lemonldap/">SSO - LemonLDAP</a></li>
								
									<li class="nav-item current"><a href="/apis/auth/oidc/">OpenID Connect</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/dev/debug/">Dev</a>
							<ul>
								
									<li class="nav-item "><a href="/dev/debug/">Debug</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/devops/james/">Devops</a>
							<ul>
								
									<li class="nav-item "><a href="/devops/james/">James</a></li>
								
									<li class="nav-item "><a href="/devops/kibana/">Kibana</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/frontend/vue/">Frontend</a>
							<ul>
								
									<li class="nav-item "><a href="/frontend/vue/">Vue.js</a></li>
								
									<li class="nav-item "><a href="/frontend/vue-auth/">Vue Authentication</a></li>
								
									<li class="nav-item "><a href="/frontend/vue-components/">Vue Components</a></li>
								
									<li class="nav-item "><a href="/frontend/i18n/">I18n</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/core/configuration/">OpenPaaS Core</a>
							<ul>
								
									<li class="nav-item "><a href="/core/configuration/">Configuration</a></li>
								
									<li class="nav-item "><a href="/core/pubsub/">Pubsub</a></li>
								
									<li class="nav-item "><a href="/core/eventsourcing/">EventSourcing</a></li>
								
									<li class="nav-item "><a href="/core/provisioning/">Provisioning</a></li>
								
									<li class="nav-item "><a href="/core/search/">Search</a></li>
								
									<li class="nav-item "><a href="/core/i18n/">I18n</a></li>
								
									<li class="nav-item "><a href="/core/people/">People API</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/modules/howto/index/">OpenPaaS Modules</a>
							<ul>
								
									<li class="nav-item "><a href="/modules/howto/index/">Overview</a></li>
								
									<li class="nav-item "><a href="/modules/howto/quickstart/">Quickstart</a></li>
								
									<li class="nav-item "><a href="/modules/howto/deep-dive/">Deep dive</a></li>
								
									<li class="nav-item "><a href="/modules/howto/install/">Install</a></li>
								
									<li class="nav-item "><a href="/modules/howto/electron-compatibility/">How to be Electron compatible</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/modules/admin/index/">OpenPaaS Modules - Admin</a>
							<ul>
								
									<li class="nav-item "><a href="/modules/admin/index/">Overview</a></li>
								
									<li class="nav-item "><a href="/modules/admin/domains/">Domains</a></li>
								
									<li class="nav-item "><a href="/modules/admin/configuration-page/">Add a configuration page</a></li>
								
									<li class="nav-item "><a href="/modules/admin/rest-api/">REST API</a></li>
								
									<li class="nav-item "><a href="/modules/admin/elasticsearch/">Elasticsearch</a></li>
								
									<li class="nav-item "><a href="/modules/admin/technical-users/">Technical users</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/modules/calendar/index/">OpenPaaS Modules - Calendar</a>
							<ul>
								
									<li class="nav-item "><a href="/modules/calendar/index/">Overview</a></li>
								
									<li class="nav-item "><a href="/modules/calendar/shared/">Shared Calendars</a></li>
								
									<li class="nav-item "><a href="/modules/calendar/resource/">Calendar Resources</a></li>
								
									<li class="nav-item "><a href="/modules/calendar/api/">REST API</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/modules/community/index/">OpenPaaS Modules - Community</a>
							<ul>
								
									<li class="nav-item "><a href="/modules/community/index/">Overview</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/modules/contact/index/">OpenPaaS Modules - Contact</a>
							<ul>
								
									<li class="nav-item "><a href="/modules/contact/index/">Overview</a></li>
								
									<li class="nav-item "><a href="/modules/contact/collected/">Collected contacts</a></li>
								
									<li class="nav-item "><a href="/modules/contact/shared/">Shared Address Books</a></li>
								
									<li class="nav-item "><a href="/modules/contact/domain-address-book/">Domain address book</a></li>
								
									<li class="nav-item "><a href="/modules/contact/domain-members-address-book/">Domain members address book</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/modules/group/index/">OpenPaaS Modules - Group</a>
							<ul>
								
									<li class="nav-item "><a href="/modules/group/index/">Overview</a></li>
								
									<li class="nav-item "><a href="/modules/group/rest-api/">REST API</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/modules/james/index/">OpenPaaS Modules - James</a>
							<ul>
								
									<li class="nav-item "><a href="/modules/james/index/">Overview</a></li>
								
									<li class="nav-item "><a href="/modules/james/rest-api/">REST API</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/modules/jobqueue/index/">OpenPaaS Modules - Job Queue</a>
							<ul>
								
									<li class="nav-item "><a href="/modules/jobqueue/index/">Overview</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/modules/smartsla/index/">OpenPaaS Modules - SmartSLA</a>
							<ul>
								
									<li class="nav-item "><a href="/modules/smartsla/index/">Overview</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/modules/unifiedinbox/index/">OpenPaaS Modules - Unified Inbox</a>
							<ul>
								
									<li class="nav-item "><a href="/modules/unifiedinbox/index/">Overview</a></li>
								
									<li class="nav-item "><a href="/modules/unifiedinbox/identity/">Identity</a></li>
								
									<li class="nav-item "><a href="/modules/unifiedinbox/rest-api/">REST API</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/modules/videoconference/index/">OpenPaaS Modules - VideoConference</a>
							<ul>
								
									<li class="nav-item "><a href="/modules/videoconference/index/">Overview</a></li>
								
									<li class="nav-item "><a href="/modules/videoconference/screensharing/">Screensharing</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/testing/midway-backend-test/index/">OpenPaaS Test Automation</a>
							<ul>
								
									<li class="nav-item "><a href="/testing/midway-backend-test/index/">Midway Backend Test</a></li>
								
							</ul>
						</li>
					
				</ul>

				<ul>
					<li class="nav-item top-level">
						<a href="javascript:;">Keep In Touch</a>
						<ul>
							<li class="nav-item">
								<a href="https://twitter.com/AwesomePaaS">@AwesomePaaS on Twitter</a>
							</li>
							<li class="nav-item">
								<a href="https://www.facebook.com/AwesomePaaS/">AwesomePaaS on Facebook</a>
							</li>
							<li class="nav-item">
								<a href="https://github.com/linagora/openpaas-esn/">Github</a>
							</li>
							<li class="nav-item">
								<a href="https://forum.open-paas.org/">Forum</a>
							</li>
							<li class="nav-item">
								<a href="https://open-paas.org/">Web Site</a>
							</li>
							<li class="nav-item">
								<a href="https://linagora.com/">Linagora</a>
							</li>
						</ul>
					</li>
				</ul>


			</nav>
		</header>
		<section class="main">
			<div class="page-header">
				<h2>APIs - Auth</h2>
				<div class="page-title">
					<h3>OpenID Connect</h3>
					<a href="https://github.com/linagora/openpaas-doc/edit/master/_docs/apis/auth/oidc.md" title="Edit this page on Github">
						<i class="fa fa-pencil-square-o" aria-hidden="true"></i>
					</a>
				</div>
			</div>
			<article class="content">
				<h2 class="no_toc" id="table-of-contents">Table of contents</h2>

<ul id="markdown-toc">
  <li><a href="#overview" id="markdown-toc-overview">Overview</a></li>
  <li><a href="#authenticating-incoming-rest-api-calls" id="markdown-toc-authenticating-incoming-rest-api-calls">Authenticating incoming REST API calls</a>    <ul>
      <li><a href="#api-configuration" id="markdown-toc-api-configuration">API Configuration</a></li>
    </ul>
  </li>
  <li><a href="#authenticating-users" id="markdown-toc-authenticating-users">Authenticating users</a>    <ul>
      <li><a href="#configuration" id="markdown-toc-configuration">Configuration</a></li>
    </ul>
  </li>
  <li><a href="#oidc-configuration" id="markdown-toc-oidc-configuration">OIDC Configuration</a></li>
  <li><a href="#user-provisioning" id="markdown-toc-user-provisioning">User provisioning</a></li>
  <li><a href="#oidc-servers" id="markdown-toc-oidc-servers">OIDC Servers</a>    <ul>
      <li><a href="#keycloak" id="markdown-toc-keycloak">Keycloak</a></li>
    </ul>
  </li>
</ul>

<h2 id="overview">Overview</h2>

<p>OpenPaaS supports <a href="https://openid.net/connect/">OpenID Connect</a> (OIDC) as Authentication/Authorization module.
OIDC can be used to authenticate users when they reach OpenPaaS ESN and when they launch an OpenPaaS powered application: User is redirected to the OIDC login page, authenticates, and is then redirected to the initial application.</p>

<p>The current page describes how to configure and use OIDC to provide this Single Sign On (SSO) support in OpenPaaS.</p>

<h2 id="authenticating-incoming-rest-api-calls">Authenticating incoming REST API calls</h2>

<p>In order to allow applications to call OpenPaaS APIs, the OIDC strategy must be enabled on the OpenPaaS ESN backend. The current section explains how to configure it.</p>

<h3 id="api-configuration">API Configuration</h3>

<p>The <code class="language-plaintext highlighter-rouge">oidc</code> strategy must be added to the list of API strategies in the <code class="language-plaintext highlighter-rouge">config/default.*.json</code> file:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"auth"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"apiStrategies"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"basic-mongo-ldap"</span><span class="p">,</span><span class="w"> </span><span class="s2">"basic-mongo"</span><span class="p">,</span><span class="w"> </span><span class="s2">"oidc"</span><span class="p">,</span><span class="w"> </span><span class="s2">"bearer"</span><span class="p">,</span><span class="w"> </span><span class="s2">"jwt"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>This strategy will:</p>

<ol>
  <li>Get the <code class="language-plaintext highlighter-rouge">Bearer</code> token from the incoming HTTP request</li>
  <li>Try to retrieve the user from the token by requesting the OIDC server</li>
  <li>“Mount” the OpenPaaS user from retrieved OIDC user email</li>
  <li>Pass the request to the next handler</li>
</ol>

<p>In order to retrieve the user from the token by requesting the OIDC server, OpenPaaS needs to be configured correctly: Configuration is described in the <code class="language-plaintext highlighter-rouge">OIDC Configuration</code> below.</p>

<h2 id="authenticating-users">Authenticating users</h2>

<p>OIDC can also be used for SSO at the OpenPaaS portal level: The user will be redirected to the OIDC login page when required. In order to achieve this, OpenPaaS must be configured and the <code class="language-plaintext highlighter-rouge">linagora.esn.oidc</code> module must be enabled. Once done, the user will be redirected to the OIDC login/logout pages when needed.</p>

<h3 id="configuration">Configuration</h3>

<ol>
  <li>The <code class="language-plaintext highlighter-rouge">linagora.esn.oidc</code> module must be added and enabled. Check the instructions here <a href="https://github.com/linagora/linagora.esn.oidc">https://github.com/linagora/linagora.esn.oidc</a>.</li>
  <li>The configuration is described in the <code class="language-plaintext highlighter-rouge">OIDC Configuration</code> section below.</li>
</ol>

<h2 id="oidc-configuration">OIDC Configuration</h2>

<p>The configuration is platform-wide and so has to be set in the <code class="language-plaintext highlighter-rouge">core</code> module in the <code class="language-plaintext highlighter-rouge">oidc</code> settings:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"core"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"configurations"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"oidc"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"issuer_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8888/auth/realms/master"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"client_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"openpaas"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"client_secret"</span><span class="p">:</span><span class="w"> </span><span class="s2">"34b398b7-79fe-4ab1-b53c-b68c20743558"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"authorization_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8888/auth/realms/master/protocol/openid-connect/auth"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"token_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8888/auth/realms/master/protocol/openid-connect/token"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"user_info_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8888/auth/realms/master/protocol/openid-connect/userinfo"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"end_session_endpoint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8888/auth/realms/master/protocol/openid-connect/logout"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="err">//</span><span class="w"> </span><span class="err">...</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Where:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">issuer_url</code> is the Issuer URL of your OIDC server</li>
  <li><code class="language-plaintext highlighter-rouge">client_id</code> is the ID of the client you configured in the OIDC server</li>
  <li><code class="language-plaintext highlighter-rouge">client_secret</code> is the unique, generated secret provided by the OIDC server</li>
  <li><code class="language-plaintext highlighter-rouge">authorization_url</code> is the authorization endpoint</li>
  <li><code class="language-plaintext highlighter-rouge">token_url</code> is the token endpoint</li>
  <li><code class="language-plaintext highlighter-rouge">user_info_url</code> is the token to fetch user information</li>
  <li><code class="language-plaintext highlighter-rouge">end_session_endpoint</code> is the URL used to end the user session (<a href="https://openid.net/specs/openid-connect-session-1_0.html#RPLogout">Spec</a>)</li>
</ul>

<p>These values are available on distinct locations based on the OIDC server you use. More details are given below.</p>

<p><strong>IMPORTANT</strong>: For now, all the applications (OpenPaaS ESN and Vue applications) are sharing the same <code class="language-plaintext highlighter-rouge">client_id</code> and MUST BE configured as is.</p>

<h2 id="user-provisioning">User provisioning</h2>

<p>When delegating authentication to OIDC, the users will be provisioned in the OpenPaaS backend when required:</p>

<ul>
  <li>When OpenPaaS ESN is loading user at login</li>
  <li>When OpenPaaS application is calling REST APIs</li>
</ul>

<p>In order to provision the user in the right domain, OpenPaaS will rely on the email address provided by the OIDC UserInfo endpoint and provision following these steps:</p>

<ol>
  <li>Extracting the email Top-Level Domain (TLD)</li>
  <li>Searching a domain with the name from email address TLD
    <ul>
      <li>If domain found then create a user in this domain</li>
      <li>Else do not provision user</li>
    </ul>
  </li>
</ol>

<p>For example, if the user email address is <code class="language-plaintext highlighter-rouge">name@open-paas.org</code>, search a domain with name <code class="language-plaintext highlighter-rouge">open-paas.org</code> then create user in this domain if it exists, else fail.</p>

<h2 id="oidc-servers">OIDC Servers</h2>

<p>The current section will give details on how to use and configure OIDC self-hosted servers as part of a development process. <strong>This is not supposed to be used as-is in production environments</strong>.</p>

<h3 id="keycloak">Keycloak</h3>

<p><a href="https://www.keycloak.org/">Keycloak</a> is an Open Source Identity and Access Management which can be used as OIDC server.</p>

<p>In the following instructions, it is assumed that Keycloak has is running on port 8888 and that we are using the <code class="language-plaintext highlighter-rouge">master</code> realm i.e.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-p</span> 8888:8080 jboss/keycloak
</code></pre></div></div>

<p>The easiest way to go is to use Docker as described in the <a href="https://hub.docker.com/r/jboss/keycloak/">Docker Hub page</a>.</p>

<p>Once logged in as admin, you should have access to the realm configuration page on <a href="http://localhost:8888/auth/admin/master/console/#/realms/master">http://localhost:8888/auth/admin/master/console/#/realms/master</a>.</p>

<p>In order to use OpenID Connect in OpenPaaS, you will have to create a <code class="language-plaintext highlighter-rouge">Client</code> in keycloak:</p>

<ol>
  <li>Go to <code class="language-plaintext highlighter-rouge">Clients</code>, then click on <code class="language-plaintext highlighter-rouge">Create</code>.</li>
  <li>Set <code class="language-plaintext highlighter-rouge">openpaas</code> as <code class="language-plaintext highlighter-rouge">Client ID</code></li>
  <li>Toggle <code class="language-plaintext highlighter-rouge">Consent Required</code> to <code class="language-plaintext highlighter-rouge">ON</code></li>
  <li>Toggle <code class="language-plaintext highlighter-rouge">Display client on consent screen</code> to <code class="language-plaintext highlighter-rouge">ON</code></li>
  <li>Toggle <code class="language-plaintext highlighter-rouge">Implicit Flow Enabled</code> to <code class="language-plaintext highlighter-rouge">ON</code></li>
  <li>Set <code class="language-plaintext highlighter-rouge">Access</code> Type to <code class="language-plaintext highlighter-rouge">confidential</code>
  <img src="/images/apis/auth/oidc/keycloak_create_client_1.png" alt="Keycloak Create Client 1" />
  <img src="/images/apis/auth/oidc/keycloak_create_client_2.png" alt="Keycloak Create Client 2" /></li>
  <li>Every time an application will have to use this OIDC client, you will have to update the <code class="language-plaintext highlighter-rouge">Valid redirect URIs</code> by adding the application ones. As an example, for OpenPaaS Vue applications, you have to add 2 redirect URLs each time. If the application is running at <a href="http://localhost:8081">http://localhost:8081</a>:
    <ul>
      <li>http://localhost:8081/oidc-callback</li>
      <li>http://localhost:8081/login</li>
      <li>http://localhost:8080</li>
      <li>http://localhost:8080/linagora.esn.oidc/callback</li>
      <li>Note: For development purposes you can define redirect URLs with wildcards like http://localhost:8080/* and http://localhost:8081/*</li>
    </ul>
  </li>
  <li>You also have to add <code class="language-plaintext highlighter-rouge">Web origins</code> to allow CORS based on your application deployment. For development purposes, <code class="language-plaintext highlighter-rouge">*</code> is enough.</li>
  <li>Click on <code class="language-plaintext highlighter-rouge">Save</code>
10.You can now get the <code class="language-plaintext highlighter-rouge">client_secret</code> from the <code class="language-plaintext highlighter-rouge">Credentials</code> tab:
  <img src="/images/apis/auth/oidc/keycloak_client_credentials.png" alt="Keycloak Credentials" /></li>
</ol>

<p>You can now configure OpenPaaS by putting the right value in platform configuration. For example, from the screenshots above, and if keycloak is running on port 8888:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"oidc"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"issuer_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8888/auth/realms/master"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"client_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"openpaas"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"client_secret"</span><span class="p">:</span><span class="w"> </span><span class="s2">"96a97f8d-2a73-46e2-b602-512e034ea5f0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"authorization_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8888/auth/realms/master/protocol/openid-connect/auth"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"token_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8888/auth/realms/master/protocol/openid-connect/token"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"user_info_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8888/auth/realms/master/protocol/openid-connect/userinfo"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"end_session_endpoint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8888/auth/realms/master/protocol/openid-connect/logout"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>In order to get user information from their access token, keycloak needs to be configured to have the same users as the ones available in OpenPaaS. Check the keycloak documentation for more information on this.</p>

<p>For development purposes, you can create users by hand in keycloak and use them in your daily development process:</p>

<ol>
  <li>Go to <code class="language-plaintext highlighter-rouge">Users</code></li>
  <li>Click on <code class="language-plaintext highlighter-rouge">Add user</code></li>
  <li>Fill the form, be sure to put the same email as the one you have in OpenPaaS user database</li>
  <li>Click on <code class="language-plaintext highlighter-rouge">Save</code>
  <img src="/images/apis/auth/oidc/keycloak_add_user.png" alt="Keycloak Add User" /></li>
  <li>Go in the <code class="language-plaintext highlighter-rouge">Credentials</code> tab, then set a <code class="language-plaintext highlighter-rouge">New password</code> and <code class="language-plaintext highlighter-rouge">Password confirmation</code></li>
  <li>Toggle <code class="language-plaintext highlighter-rouge">Temporary</code> to <code class="language-plaintext highlighter-rouge">OFF</code></li>
  <li>Hit <code class="language-plaintext highlighter-rouge">Enter</code> to save
  <img src="/images/apis/auth/oidc/keycloak_user_credentials.png" alt="Keycloak User Credentials" /></li>
</ol>

<p>If you have a LDAP directory running somewhere in your environment, you can also use the keycloak user federation feature and import your LDAP users. Check the keycloak documentation for more details at <a href="https://www.keycloak.org/docs/6.0/server_admin/#_ldap">https://www.keycloak.org/docs/6.0/server_admin/#_ldap</a>.</p>

			</article>
		</section>

		<script>
			var content = document.getElementsByClassName('content')[0];

			if (content) {
				var viewer = new Viewer(content, {
					movable: false,
					rotatable: false
				});

				var images = content.getElementsByTagName('img');
				for (var i = 0; i < images.length; i++) {
					images[i].style.cursor = 'pointer';
				}
			}

			document.getElementById("open-nav").addEventListener("click", function () {
				document.body.classList.toggle("nav-open");
			});
		</script>
	</body>
</html>
